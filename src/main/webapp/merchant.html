<div class="col-sm-9 col-sm-offset-3 col-md-10 col-md-offset-2 main">
    <div class="title page-header">
        <div class="right">
            <button class="btn btn-success" onclick="indexPage.setContentBody('merchantAdd.html')" type="button">添加系统用户</button>
        </div>
        <h1>系统用户查询</h1>
    </div>
    <div class="table-responsive">
        <table id="tableResult" data-pagination="true" data-side-pagination="server" data-striped="true" data-cache="false"
               data-unique-id="id" data-pagination-pre-text="上一页" data-pagination-next-text="下一页"></table>
    </div>
    <div id="deleteConfimModal"></div>
</div>
<script>
    var merchantPage = {};
    (function (page) {
        function searchTableDatas() {
            $('#tableResult').bootstrapTable({
                url: 'api/merchant/all',
                method: "get",
                contentType: "application/x-www-form-urlencoded",
                queryParams: function (params) {
                    return {pageSize: params.limit, pageNumber: params.offset / params.limit};
                },
                columns: [
                    {
                        title: '序号', align: "center",
                        formatter: function (value, row, index) {
                            return index + 1;
                        }
                    },
                    {title: '用户账号', field: 'phoneNumber'},
                    {title: '姓名', field: 'name'},
                    {title: '性别', field: 'sex'},
                    {title: '用户角色', field: 'merchantUserType'},
                    {
                        title: '操作', field: 'id', formatter: function (value, row, index) {
                            var html = '<button type="button" class="btn btn-warning" onclick="merchantPage.edit(' + value + ');"><span class="glyphicon glyphicon-pencil" aria-hidden="true"></span>修改</button>';
                            html += ' <button type="button" class="btn btn-danger" onclick="merchantPage.delete(' + value + ');"><span class="glyphicon glyphicon-remove" aria-hidden="true"></span>删除</button>';
                            return html;
                        }
                    }
                ]
            });
        };

        page.edit = function (id) {
            var currentData = $("#tableResult").bootstrapTable("getRowByUniqueId", id);
            indexPage.setContentBody("merchantUpdate.html", function (response, status, xhr) {
                merchantUpdatePage.setData(currentData);
            });
        };

        page.delete = function (id) {
            deleteConfirmModal.showModal();
            deleteConfirmModal.bindDeleteAction(deleteMerchant, id);
        };

        function deleteMerchant(id) {
            $.ajax({
                type: "DELETE", url: "api/merchant/" + id,
                data: {},
                success: function (result) {
                    if (result.status === SUCCESS)
                        $("#tableResult").bootstrapTable("refresh", {silent: true});
                    else
                        commonModal.showModal(result.data);
                }
            });
        }

        function changeActiveStatus(id, status) {
            $.ajax({
                type: "PUT", url: "api/merchant/goodsType/changeActiveStatus",
                data: {id: id, isActive: status,},
                success: function (result) {
                    $("#tableResult").bootstrapTable("refresh", {silent: true});
                }
            });
        }

        $(function () {
            searchTableDatas();
            $("#deleteConfimModal").load("deleteConfirmModal.html");
        });
    })(merchantPage);
</script>